REMARKS  Testing f' and f'' refinements
remarks  

struct 
data_cns_mtf

_cns_mtf.title
; FILENAME="/data/rwgk/test/tmp.mtf"
  FRAGMENT FOR COPROL121 FOR TESTING

  DATE:18-Nov-98  14:17:57       created by user: rwgk
  VERSION:0.4a
;

loop_
_cns_mtf_atom.id
_cns_mtf_atom.segment_id
_cns_mtf_atom.residue_id
_cns_mtf_atom.residue_name
_cns_mtf_atom.atom_name
_cns_mtf_atom.chemical_type
_cns_mtf_atom.charge
_cns_mtf_atom.atom_mass
1 'TEST' '1' 'VAL' 'HT1' 'HC' 0.350000 1.00800
2 'TEST' '1' 'VAL' 'HT2' 'HC' 0.350000 1.00800
3 'TEST' '1' 'VAL' 'N' 'NH3' -0.300000 14.0067
4 'TEST' '1' 'VAL' 'HT3' 'HC' 0.350000 1.00800
5 'TEST' '1' 'VAL' 'CA' 'CH1E' 0.250000 13.0190
6 'TEST' '1' 'VAL' 'CB' 'CH1E' 0.000000E+00 13.0190
7 'TEST' '1' 'VAL' 'CG1' 'CH3E' 0.000000E+00 15.0350
8 'TEST' '1' 'VAL' 'CG2' 'CH3E' 0.000000E+00 15.0350
9 'TEST' '1' 'VAL' 'C' 'C' 0.550000 12.0110
10 'TEST' '1' 'VAL' 'O' 'O' -0.550000 15.9994
11 'TEST' '2' 'LEU' 'N' 'NH1' -0.350000 14.0067
12 'TEST' '2' 'LEU' 'H' 'H' 0.250000 1.00800
13 'TEST' '2' 'LEU' 'CA' 'CH1E' 0.100000 13.0190
14 'TEST' '2' 'LEU' 'CB' 'CH2E' 0.000000E+00 14.0270
15 'TEST' '2' 'LEU' 'CG' 'CH1E' 0.000000E+00 13.0190
16 'TEST' '2' 'LEU' 'CD1' 'CH3E' 0.000000E+00 15.0350
17 'TEST' '2' 'LEU' 'CD2' 'CH3E' 0.000000E+00 15.0350
18 'TEST' '2' 'LEU' 'C' 'C' 0.550000 12.0110
19 'TEST' '2' 'LEU' 'O' 'O' -0.550000 15.9994
20 'TEST' '3' 'SER' 'N' 'NH1' -0.350000 14.0067
21 'TEST' '3' 'SER' 'H' 'H' 0.250000 1.00800
22 'TEST' '3' 'SER' 'CA' 'CH1E' 0.100000 13.0190
23 'TEST' '3' 'SER' 'CB' 'CH2E' 0.250000 14.0270
24 'TEST' '3' 'SER' 'OG' 'OH1' -0.650000 15.9994
25 'TEST' '3' 'SER' 'HG' 'H' 0.400000 1.00800
26 'TEST' '3' 'SER' 'C' 'C' 0.140000 12.0110
27 'TEST' '3' 'SER' 'OT1' 'OC' -0.570000 15.9994
28 'TEST' '3' 'SER' 'OT2' 'OC' -0.570000 15.9994
-1 ' ' ' ' ' ' ' ' ' ' -1.00000 -1.00000

loop_
_cns_mtf_bond.id[1]
_cns_mtf_bond.id[2]
3 5
5 9
9 10
5 6
6 7
6 8
1 3
2 3
4 3
11 13
13 18
18 19
11 12
13 14
14 15
15 16
15 17
9 11
20 22
22 26
20 21
22 23
23 24
24 25
18 20
26 27
26 28
-1 -1

loop_
_cns_mtf_angle.id[1]
_cns_mtf_angle.id[2]
_cns_mtf_angle.id[3]
3 5 9
3 5 6
5 9 10
9 5 6
5 6 7
5 6 8
7 6 8
1 3 2
2 3 4
2 3 5
1 3 4
1 3 5
4 3 5
11 13 18
13 11 12
11 13 14
13 18 19
18 13 14
13 14 15
14 15 16
14 15 17
16 15 17
5 9 11
10 9 11
9 11 13
9 11 12
20 22 26
22 20 21
20 22 23
26 22 23
22 23 24
23 24 25
13 18 20
19 18 20
18 20 22
18 20 21
22 26 27
22 26 28
27 26 28
-1 -1 -1

loop_
_cns_mtf_dihedral.id[1]
_cns_mtf_dihedral.id[2]
_cns_mtf_dihedral.id[3]
_cns_mtf_dihedral.id[4]
3 5 6 7
2 3 5 9
1 3 5 9
4 3 5 9
11 13 14 15
13 14 15 17
9 11 13 18
3 5 9 11
5 9 11 13
20 22 23 24
22 23 24 25
18 20 22 26
11 13 18 20
13 18 20 22
20 22 26 28
-1 -1 -1 -1

loop_
_cns_mtf_improper.id[1]
_cns_mtf_improper.id[2]
_cns_mtf_improper.id[3]
_cns_mtf_improper.id[4]
5 3 9 6
6 8 7 5
13 11 18 14
15 17 16 14
9 5 11 10
11 9 13 12
22 20 26 23
18 13 20 19
20 18 22 21
26 22 28 27
-1 -1 -1 -1

loop_
_cns_mtf_explicit_nonbonded_exclusion.inb
-1

loop_
_cns_mtf_explicit_nonbonded_exclusion.iblo
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
0
-1

loop_
_cns_mtf_group_linked_list.first_atom_id
0
5
8
10
13
17
19
22
25
-1

END

param @CNS_TOPPAR:protein.param end
coor 
REMARK FILENAME=""
REMARK - parameter file PARAM19 -
REMARK PEPTIDE GEOMETRY FROM RAMACHANDRAN ET AL BBA 359:298 (1974)
REMARK TORSIONS FROM HAGLER ET AL JACS 98:4600 (1976)
REMARK JORGENSEN NONBOND PARAMETERS JACS 103:3976-3985 WITH 1-4 RC=1.80/0.1
REMARK DATE: 1-APR-87  14:48:04       created by user: KURIYAN
ATOM      1  HT1 VAL     1      -3.950  -0.677  -2.142  1.00  0.00      TEST
ATOM      2  HT2 VAL     1      -4.064   0.998  -1.881  1.00  0.00      TEST
ATOM      3  N   VAL     1      -4.207   0.060  -1.454  1.00 25.01      TEST
ATOM      4  HT3 VAL     1      -5.206  -0.049  -1.186  1.00  0.00      TEST
ATOM      5  CA  VAL     1      -3.353  -0.070  -0.245  1.00 10.21      TEST
ATOM      6  CB  VAL     1      -3.658  -1.409   0.478  1.00 26.78      TEST
ATOM      7  CG1 VAL     1      -3.667  -1.256   2.018  1.00 25.94      TEST
ATOM      8  CG2 VAL     1      -4.972  -2.085   0.140  1.00 28.48      TEST
ATOM      9  C   VAL     1      -1.899   0.093  -0.656  1.00 10.47      TEST
ATOM     10  O   VAL     1      -1.503  -0.499  -1.673  1.00 14.11      TEST
ATOM     11  N   LEU     2      -1.104   0.902   0.074  1.00 17.15      TEST
ATOM     12  H   LEU     2      -1.490   1.500   0.747  1.00  0.00      TEST
ATOM     13  CA  LEU     2       0.340   0.876  -0.150  1.00  9.88      TEST
ATOM     14  CB  LEU     2       1.098   2.086   0.497  1.00 13.33      TEST
ATOM     15  CG  LEU     2       0.790   3.394  -0.296  1.00 13.63      TEST
ATOM     16  CD1 LEU     2      -0.578   3.799  -0.189  1.00 13.95      TEST
ATOM     17  CD2 LEU     2       1.732   4.405   0.290  1.00 14.84      TEST
ATOM     18  C   LEU     2       0.873  -0.476   0.385  1.00  6.06      TEST
ATOM     19  O   LEU     2       0.434  -0.879   1.428  1.00  8.72      TEST
ATOM     20  N   SER     3       1.811  -0.923  -0.413  1.00 13.05      TEST
ATOM     21  H   SER     3       1.940  -0.537  -1.304  1.00  0.00      TEST
ATOM     22  CA  SER     3       2.652  -2.004   0.059  1.00  9.81      TEST
ATOM     23  CB  SER     3       3.463  -2.643  -1.064  1.00 15.39      TEST
ATOM     24  OG  SER     3       4.388  -1.619  -1.668  1.00 16.37      TEST
ATOM     25  HG  SER     3       3.872  -0.891  -2.023  1.00  0.00      TEST
ATOM     26  C   SER     3       3.590  -1.457   1.157  1.00  7.20      TEST
ATOM     27  OT1 SER     3       3.770  -0.296   1.284  1.00 14.37      TEST
END
do (q=0.8) ( resid 1 )
do (q=0.7) ( resid 2 )
do (q=0.9) ( resid 3 )


delete sele ( not known ) end
flags excl * incl xray end 

{* read diffraction data *}
xray
   declare name=fobs type=complex domain=reciprocal end
   declare name=fpart domain=reciprocal type=complex end
   declare name=fcalc domain=reciprocal type=complex end
   declare name=fom domain=reciprocal type=real end
   declare name=weight domain=reciprocal type=real end
   declare name=sigma domain=reciprocal type=real end
   declare name=test domain=reciprocal type=integer end

   a=5.0 b=10.0 c=5.0 alpha=90.0 beta=90.0 gamma=90.0
   symmetry=(x,y,z)
   symmetry=(-X,Y+1/2,-Z)
   SCATter ( chemical C* ) 
   2.31000 20.8439 1.02000 10.2075 1.58860 .568700 .865000 51.6512 .215600

   SCATter ( chemical N* )
   12.2126 .005700 3.13220 9.89330 2.01250 28.9975 1.16630 .582600 -11.529
   imag 4. 

   SCATter ( chemical O* )
   3.04850 13.2771 2.28680 5.70110 1.54630 .323900 .867000 32.9089 .250800

   SCATter ( chemical S* )
   6.90530 1.46790 5.20340 22.2151 1.43790 .253600 1.58630 56.1720 .866900
 
   nreflections=1000  

  evaluate ($lr=10.)
  evaluate ($hr=3.) 
  binresolution $lr $hr 
  mapresolution $hr
  tselection=( $hr <= d <= $lr ) 

  anomalous=true
  aselection=( not all ) 
  generate 10. 3.
  predict 
      mode=reciprocal 
      to=fcalc 
      selection=( $hr <= d <= $lr ) 
      atomselection=( not hydrogen ) 
  end 
  do (fobs=fcalc) ( all )
  do (fpart=0) ( all ) 

   scatter reset 
   SCATter ( chemical C* ) 
   2.31000 20.8439 1.02000 10.2075 1.58860 .568700 .865000 51.6512 .4

   SCATter ( chemical N* )
   12.2126 .005700 3.13220 9.89330 2.01250 28.9975 1.16630 .582600 -13.
   imag 4. 

   SCATter ( chemical O* )
   3.04850 13.2771 2.28680 5.70110 1.54630 .323900 .867000 32.9089 -.1

   SCATter ( chemical S* )
   6.90530 1.46790 5.20340 22.2151 1.43790 .253600 1.58630 56.1720 -1.0
 
   predict 
      mode=reciprocal 
      to=fcalc 
      selection=( $hr <= d <= $lr ) 
      atomselection=( not hydrogen ) 
   end 

 print target
 wa = 1000.0
end
!

{* debug group B-factor and occupancy derivatives *}
{* ============================================== *}
xray               
  evaluate ($lr=10.)
  evaluate ($hr=2.01) 
  binresolution $lr $hr 
  mapresolution $hr
  tselection=( $hr <= d <= $lr ) 

 method=fft lookup=true
 optimize group
  drop=0.01 ! step for debugger
  fp=( chemical c* ) 
  fp=( chemical n* )
  fp=( chemical o* ) 
  debug=true
 end
 method=fft lookup=false
 optimize group
  drop=0.00001 ! step for debugger
  fp=( chemical c* ) 
  fp=( chemical n* )
  fp=( chemical o* ) 
  debug=true
 end
 method=direct 
 optimize group
  drop=0.00001 ! step for debugger
  fp=( chemical c* ) 
  fp=( chemical n* )
  fp=( chemical o* ) 
  debug=true
 end
 scatter ?
 optimize group 
  drop=10. 
  nstep=5
  fp=( chemical c* ) 
  fp=( chemical n* )
  fp=( chemical o* ) 
   tolerance=0.0
  end
  scatter ?
  
  predict 
      mode=reciprocal 
      to=fcalc 
      selection=( $hr <= d <= $lr ) 
      atomselection=( not hydrogen ) 
  end 
  print target
end


xray

   scatter reset 
   SCATter ( chemical C* ) 
   2.31000 20.8439 1.02000 10.2075 1.58860 .568700 .865000 51.6512 .4

   SCATter ( chemical N* )
   12.2126 .005700 3.13220 9.89330 2.01250 28.9975 1.16630 .582600 -13.
   imag 4. 

   SCATter ( chemical O* )
   3.04850 13.2771 2.28680 5.70110 1.54630 .323900 .867000 32.9089 -.1

   SCATter ( chemical S* )
   6.90530 1.46790 5.20340 22.2151 1.43790 .253600 1.58630 56.1720 -1.0
  
   aselection=( chemical N* ) 

   predict 
      mode=reciprocal 
      to=fcalc 
      selection=( $hr <= d <= $lr ) 
      atomselection=( not hydrogen ) 
   end 
   do (fobs=fcalc) ( all )
   scatter reset 
   SCATter ( chemical C* ) 
   2.31000 20.8439 1.02000 10.2075 1.58860 .568700 .865000 51.6512 .4

   SCATter ( chemical N* )
   12.2126 .005700 3.13220 9.89330 2.01250 28.9975 1.16630 .582600 -13.
   imag 10. 

   SCATter ( chemical O* )
   3.04850 13.2771 2.28680 5.70110 1.54630 .323900 .867000 32.9089 -.1

   SCATter ( chemical S* )
   6.90530 1.46790 5.20340 22.2151 1.43790 .253600 1.58630 56.1720 -1.0
 
   predict 
      mode=reciprocal 
      to=fcalc 
      selection=( $hr <= d <= $lr ) 
      atomselection=( not hydrogen ) 
   end 

   statistics
      (rvalue(fobs,fcalc+fpart))
      (rvalue[overall](fobs,fcalc+fpart))
      selection=( $hr <= d <= $lr ) 
      output=OUTPUT
   end
               
  evaluate ($lr=10.)
  evaluate ($hr=2.01) 
  binresolution $lr $hr 
  mapresolution $hr
  tselection=( $hr <= d <= $lr ) 
  
 method=fft  lookup=true
 optimize group
  drop=0.01 ! step for debugger
  fdp=( chemical c* ) 
  fdp=( chemical n* )
  fdp=( chemical o* ) 
  debug=true
 end
 method=fft  lookup=false
 optimize group
  drop=0.00001 ! step for debugger
  fdp=( chemical c* ) 
  fdp=( chemical n* )
  fdp=( chemical o* ) 
  debug=true
 end
 method=direct 
 optimize group
  drop=0.00001 ! step for debugger
  fdp=( chemical c* ) 
  fdp=( chemical n* )
  fdp=( chemical o* ) 
  debug=true
 end
 optimize group 
  drop=10. 
  nstep=5
  fdp=( chemical c* ) 
  fdp=( chemical n* )
  fdp=( chemical o* ) 
   tolerance=0.0
  end
 scatter ?
end



show elem ( scatter_a1) ( all )
show elem ( scatter_a2) ( all )
show elem ( scatter_a3) ( all )
show elem ( scatter_a4) ( all )
show elem ( scatter_b1) ( all )
show elem ( scatter_b2) ( all )
show elem ( scatter_b3) ( all )
show elem ( scatter_b4) ( all )
show elem ( scatter_c)  ( all ) 
show elem ( scatter_fp) ( all )
show elem ( scatter_fdp) ( all )

xray
  scatter ?
end

do (scatter_a1=11) ( chemical c* or chemical n* ) 
do (scatter_b1=21) ( chemical c* or chemical n* ) 
do (scatter_a2=12) ( chemical c* or chemical n* ) 
do (scatter_b2=22) ( chemical c* or chemical n* ) 
do (scatter_a3=13) ( chemical c* or chemical n* ) 
do (scatter_b3=23) ( chemical c* or chemical n* ) 
do (scatter_a4=14) ( chemical c* or chemical n* ) 
do (scatter_b4=24) ( chemical c* or chemical n* ) 
do (scatter_c=0)   ( chemical c* or chemical n* ) 
do (scatter_fp=15) ( chemical c* or chemical n* ) 
do (scatter_fdp=25) ( chemical c* or chemical n* ) 

xray
   scatter ?
end

do (chemical=c) ( chemical c* ) 
do (chemical=n) ( chemical n* ) 
xray
   scatter ?
end

stop


