<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>Crystallography &amp; NMR System</title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1038.32">
  <style type="text/css">
    body {background-color: #8abf8c}
    p.p2 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times}
    p.p5 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Courier}
    p.p7 {margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times}
    p.p9 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
    p.p12 {margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times; min-height: 18.0px}
    p.p13 {margin: 0.0px 0.0px 7.0px 0.0px; text-align: center; font: 14.0px Times; min-height: 18.0px}
    p.p14 {margin: 0.0px 0.0px 14.0px 0.0px; text-align: center; font: 14.0px Times; min-height: 18.0px}
    li.li3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times}
    li.li4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Courier}
    li.li5 {margin: 0.0px 0.0px 12.0px 0.0px; font: 12.0px Courier}
    li.li6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Courier}
    li.li7 {margin: 0.0px 0.0px 14.0px 0.0px; font: 14.0px Times}
    li.li8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Times}
    span.s1 {text-decoration: underline ; color: #000ff4}
    span.s2 {font: 12.0px Times}
    span.s3 {text-decoration: underline}
    span.s4 {font: 12.0px Courier}
    span.s5 {font: 12.0px 'Lucida Grande'}
    span.s6 {text-decoration: underline ; color: #0000ee}
    span.s7 {font: 14.0px 'Lucida Grande'}
    span.s8 {font: 18.0px Courier}
    span.s9 {font: 14.0px Courier}
    span.s10 {font: 14.0px Times}
    table.t1 {border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080}
    td.td1 {width: 3.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 2.0px 2.0px 2.0px 2.0px}
    td.td2 {width: 13.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 2.0px 2.0px 2.0px 2.0px}
    td.td3 {width: 53.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 2.0px 2.0px 2.0px 2.0px}
    td.td4 {width: 38.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 2.0px 2.0px 2.0px 2.0px}
    td.td5 {width: 20.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 2.0px 2.0px 2.0px 2.0px}
    td.td6 {width: 47.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 2.0px 2.0px 2.0px 2.0px}
    td.td7 {width: 128.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 2.0px 2.0px 2.0px 2.0px}
    td.td8 {width: 37.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 2.0px 2.0px 2.0px 2.0px}
    td.td9 {width: 40.0px; border-style: solid; border-width: 1.0px 1.0px 1.0px 1.0px; border-color: #808080 #808080 #808080 #808080; padding: 2.0px 2.0px 2.0px 2.0px}
    ul.ul1 {list-style-type: disc}
    ul.ul2 {list-style-type: circle}
  </style>
</head>
<body>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Binary installation on Intel Macintosh running OS X</b></h2>
<p class="p2">A binary installation is available for Intel Macintosh OS X, running version 10.6.2 or later. This version is compiled with the ifort compiler in 32 bit mode with parallelization enabled for computing intensive tasks such as FFT calculations. To install you need a valid CNS download username and password.</p>
<ul class="ul1">
  <li class="li3">Go to <a href="http://cns-online.org/cns_request"><span class="s1">Download</span></a> and follow the instructions.</li>
  <li class="li4"><span class="s2">download </span><span class="s3">cns_solve_1.3_all_intel-mac_linux.tar.gz</span></li>
  <li class="li3">uncompress and extract the CNSsolve tar archive:</li>
  <li class="li3">gunzip cns_solve_1.3_all_intel-mac_linux-mp.tar.gz</li>
  <li class="li3">tar xvf cns_solve_1.3_all_intel-mac_linux-mp.tar</li>
</ul>
<p class="p2">The following will setup the CNSsolve program . Important: do not issue the "make install" command.</p>
<ul class="ul1">
  <li class="li3">edit the file cns_solve_env - change the line: <span class="s4">setenv CNS_SOLVE 'location of CNSsolve directory'</span><span class="s5"><br>
</span></li>
  <li class="li3">before using CNSsolve you must:</li>
</ul>
<p class="p5">source cns_solve_env</p>
<p class="p2">Note: this requires the csh or tcsh Unix shell.</p>
<p class="p2"> </p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Binary installation on Intel  architectures running Linux</b></h2>
<p class="p2">A binary installation is available for Intel x8_64 and other compatible Linux platforms. This version is compiled with the ifort compiler  with parallelization enabled for computing intensive tasks such as FFT calculations. To install you need a valid CNS download username and password.</p>
<ul class="ul1">
  <li class="li3">Go to <a href="http://cns-online.org/cns_request"><span class="s1">Download</span></a> and follow the instructions.</li>
  <li class="li4"><span class="s2">download </span><span class="s3">cns_solve_1.3_all_intel-mac_linux.tar.gz</span></li>
  <li class="li3">uncompress and extract the CNSsolve tar archive:</li>
  <li class="li3">gunzip cns_solve_1.3_all_intel-mac_linux-mp.tar.gz</li>
  <li class="li3">tar xvf cns_solve_1.3_all_intel-mac_linux-mp.tar</li>
</ul>
<p class="p2">The following will setup the CNSsolve program . Important: do not issue the "make install" command.</p>
<ul class="ul1">
  <li class="li3">edit the file cns_solve_env - change the line: <span class="s4">setenv CNS_SOLVE 'location of CNSsolve directory'</span><span class="s5"><br>
</span></li>
  <li class="li3">before using CNSsolve: <span class="s4">source cns_solve_env</span><span class="s5"><br>
</span></li>
</ul>
<p class="p2">Note: this requires the csh or tcsh Unix shell.</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>OpenMP parallelization for Mac OS X and Linux architectures</b></h2>
<p class="p2">The parallelized version of CNS 1.3 enables parallel computations for some steps (especially FFTs) in the crystallographic refinement process on Mac OS X and Linux architectures. By default, the program will utilize the existing number of processors on your system for the portions of the code that are parallelized. In order to restrict the number of processors to be utilized set the environmental variable OMP_NUM_THREADS to the number of processors you want to use. Note, that the sizes for the electron density grid may be slightly different for different number of threads.</p>
<p class="p2">The following commented-out line is included in cns_solve_env. Uncomment and change as appropriate to set the number of threads ("processors"):</p>
<ul class="ul1">
  <li class="li6"># setenv OMP_NUM_THREADS 4</li>
</ul>
<p class="p2">Note that the following statements have been inserted in the cns_solve_env file in order to prevent segmentation faults when executing the parallelized program under certain conditions. KMP_STACKSIZE is specific to Intel's ifort/icc compilers. OMP_STACKSIZE is interpreted by all compilers. Try to increase these stacksizes if segmentation faults occur or if the job "hangs".</p>
<ul class="ul1">
  <li class="li6">limit stacksize unlimited</li>
  <li class="li6">##setenv KMP_STACKSIZE 256m</li>
  <li class="li6">setenv OMP_STACKSIZE 256m</li>
</ul>
<p class="p2"> </p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>General installation</b></h2>
<p class="p2">For all other architectures, compilation is required. To install:</p>
<ul class="ul1">
  <li class="li3">you need a valid CNS download username and password, go to <a href="http://cns-online.org/cns_request"><span class="s6">Download</span></a></li>
  <li class="li3">download cns_solve_1.3_all.tar.gz</li>
  <li class="li3">uncompress and extract the CNSsolve tar archive:</li>
  <ul class="ul2">
    <li class="li6">gunzip cns_solve_1.3_all-mp.tar.gz</li>
    <li class="li6">tar xvf cns_solve_1.3_all-mp.tar</li>
  </ul>
  <li class="li3"><b>Note</b> If you have previously installed CNSsolve ensure that the old directory will not be overwritten by the new tar file. Tar files will extract as cns_solve_'version-name''patch-name', e.g. cns_solve_1.3. If this directory already exists then move it somewhere else during installation of the new tar file. We strongly recommend that patches are used to update the same version of CNSsolve rather than installation of a complete distribution. A complete distribution only needs to be downloaded and installed by new users or when a new version of CNSsolve is released.</li>
</ul>
<p class="p2">The tar file will create a unique directory name for this version of CNSsolve (cns_solve_'version-name''patch-name', e.g. cns_solve_1.3). It is then possible to have several different versions of CNSsolve installed simultaneously, any of which can be accessed by the user.</p>
<p class="p2">The following will compile the CNSsolve program and utilities</p>
<ul class="ul1">
  <li class="li3">edit the file cns_solve_env - change the line:</li>
  <li class="li5">setenv CNS_SOLVE 'location of CNSsolve directory'<span class="s5"><br>
</span></li>
  <li class="li3">in the CNSsolve directory type:</li>
  <li class="li5">make install<span class="s5"><br>
</span></li>
  <li class="li3">before using CNSsolve:</li>
  <li class="li5">source cns_solve_env<span class="s5"><br>
</span></li>
</ul>
<p class="p2">Note: these commands require the csh or tcsh Unix shell.</p>
<p class="p2">The machine architecture is automatically determined at installation time. For example on a modern Intel system running Linux the architecture will be automatically determined to be: intel-i686-linux. A directory will be made with this name and the appropriate files automatically installed and compiled in this directory.</p>
<p class="p2">Once installed the machine architecture directory should not be moved.</p>
<p class="p2">If you have several different Fortran compilers on your system (e.g., ifort and pgf95 on Mac OS X or ifort and gfortran on Linux) you can force a particular compiler by setting the environmental variable fc prior to executing "make install". For example:</p>
<ul class="ul1">
  <li class="li6">setenv fc pgf95</li>
  <li class="li6">make install</li>
</ul>
<p class="p2">compiles the program using the Portland group pgf95 compiler.</p>
<p class="p2">Alternatively, you can use the "compiler" option when running install:</p>
<ul class="ul1">
  <li class="li6">make install compiler=pgf95</li>
</ul>
<p class="p2">For several machine types, several different compilers can be used. For example, for 64bit Linux machines, there are several files in instlib/machine/supported/intel-x86_64bit-linux:</p>
<ul class="ul1">
  <li class="li3">Makefile.header.1.ifort ! compilation with ifort compiler</li>
  <li class="li3">Makefile.header.4.ifort_mp ! compilation with ifort compiler with OpenMP parallelization enabled</li>
  <li class="li3">Makefile.header.2.gfortran ! compilation with gfortran compiler</li>
  <li class="li3">Makefile.header.7.gfortran_mp ! compilatiom with gfortran compiler with OpenMP parallelization enabled</li>
  <li class="li3">Makefile.header.3.pgf95 ! compilation with pgf95 compiler</li>
  <li class="li3">Makefile.header.5.ifort_mp_profile ! for development: compilation with ifort profiler and OpenMP</li>
  <li class="li3">Makefile.header.6.ifort_mp_tcheck ! for development: compilation with ifort thread checking and OpenMP</li>
</ul>
<p class="p2">The number in the file name indicates the priority for which compiler is used. Thus, if ifort is available it will be used, otherwise gfortran or then pgf95. If none of these compilers are available, the installation will fail and exit</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Using the Bourne shell script cns_solve_env_sh instead of the C shell cns_solve_env</b></h2>
<p class="p2">Instead of the C shell cns_solve_env you may also use the Bourne shell script cns_solve_env_sh located in the CNS root directory. Rename the file to cns_solve_env.sh and make appopriate modifications as outlined for the cns_solve_env script file. Note that the Bourne shell script has not been thoroughly tested. </p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Installation on multiple machine types</b></h2>
<p class="p2">Each machine type is installed in a unique directory therefore it is easy to install CNSsolve on several different types of machines simultaneously on a shared filesystem. Access to the correct executable is automatic.</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Different versions of operating systems</b></h2>
<p class="p2">If several machines of the same type are available with different versions of the operating system it is sufficient to install CNSsolve on only one of the machines - the one with the earliest version of the operating system. Subsequent user access to CNSsolve via the cns_solve_env script will use the closest compatible executable compiled for an earlier version of the operating system.</p>
<p class="p2"><i>NB. It is assumed that a later version of an operating system is backward compatible with an earlier one, if this is not the case then CNSsolve must be installed on both machines.</i></p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Supported installations (tested with CNS version 1.3 or later)</b></h2>
<ul class="ul1">
  <li class="li7">PCs (i386, i486, i586, i686, x86_64) running Linux, compiling with Intel ifort or GNU gfortran, both 32bit and 64 bit. <span class="s7"><br>
</span>Mac running Intel OS X 10.5.x 64-bit, compiling with Intel ifort or Portland Group pgf95</li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Unsupported (legacy) installations (these have not been tested with CNS version 1.3 or later)</b></h2>
<ul class="ul1">
  <li class="li3">SGI (R4000 and later) running IRIX 4.0.5 or later</li>
  <li class="li3">HP (PA Risc) running HP-UX 9.05 or later</li>
  <li class="li3">Compaq Alpha running OSF1/Digital Unix/Tru64 Unix</li>
  <li class="li3">Convex running ConvexOS</li>
  <li class="li3">Cray (J90, YMP, C90, T90) running Unicos</li>
  <li class="li3">Cray T3E (single CPU) running Unicosmk</li>
  <li class="li3">IBM RS/6000 running AIX</li>
  <li class="li3">Mac PPC, compiling with GNU gfortran</li>
  <li class="li3">Sun running SunOS</li>
  <li class="li3">Windows-98/Windows-NT systems with g77/gcc (EGCS-1.1)</li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>General installation problems</b></h2>
<ul class="ul1">
  <li class="li3">You do not have a working Fortran compiler</li>
  <li class="li3">You have a working Fortran compiler but it is not in your path</li>
  <li class="li3">The UNIX program <span class="s8">make</span> does not work the way we expect it to on this machine</li>
  <li class="li3">on Convex machines you should use GNUs version of make (<span class="s8">gmake</span>): <span class="s9">alias make 'gmake'</span></li>
  <li class="li3">The version of the operating system and/or compiler on this machine fails to compile the code</li>
  <li class="li3">Installation files are not provided for this machine</li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Installing a CNSsolve update (patch)</b></h2>
<p class="p2">Note: this mechanism is currently not used. Instead, only full installations are available even for patch level releases such as CNS 1.3.</p>
<p class="p2">Instead of having to download the whole distribution, updates to the current version are sometimes available as patch files. These patch files will update from the current version at a certain patch level to a new patch level. Users are not usually required to update their input files after a patch is applied - files for a particular version should work at any patch level. Updating to a new version will require downloading of a complete distribution, and users to update their input files.</p>
<p class="p2">Patch files:</p>
<ul class="ul1">
  <li class="li3">Patch files are compressed tar files.</li>
  <li class="li3">They have a consistent naming convention: patch_0.5e_0.5f.tar.Z (this patch updates CNSsolve version 0.5 at patch level e to patch level f). Versions are always numbers, patch levels are always single letters of the alphabet.<span class="s5"><br>
</span>In general, patches will be available to update from one patch level to the next (e.g. 0.5a to 0.5b, 0.5b to 0.5c). In rare cases patch files may be released which update the base level (unpatched) CNSsolve version to the latest patch level (e.g. 0.5 to 0.5g).</li>
</ul>
<p class="p2">Applying a patch:</p>
<ul class="ul1">
  <li class="li3">Download the relevant patch file from the CNS ftp server.</li>
  <li class="li3">Place the patch file in the main CNSsolve directory.</li>
  <li class="li3"><span class="s10">Type </span>make patch<span class="s10">.</span></li>
  <li class="li3">The patch file will be extracted. Any new files or replacements for old files will be installed. Any out-of-date files which are no longer required will be automatically removed by the patch.</li>
  <li class="li3">After successful installation of the patch a directory will be created called <span class="s9">patches-done</span>, the patch file will be moved into this directory so that a record of installed patches is available to the user.</li>
  <li class="li3">After patch installation, you must type <span class="s9">make update</span> on all installation machines in order to recompile any new code.</li>
</ul>
<p class="p2">Possible problems:</p>
<ul class="ul1">
  <li class="li3">The message <span class="s9">environmental variable $CNS_SOLVE is not defined</span> is given and the patching process stops. You need to source the cns_solve_env file to continue.</li>
  <li class="li3">The message <span class="s9">no patch file present</span> is given and the patching process stops. You forgot to put the patch file in the main CNSsolve directory.</li>
  <li class="li3">The message <span class="s9">only one patch file can be applied at a time</span> is given and the patching process stops. You have more than one patch file in the main CNSsolve directory, remove the old one(s).</li>
  <li class="li3">The message <span class="s9">installed version of CNSsolve does not match the patch file</span> is given and the patching process stops. You CNSsolve version is either too old or too new for this patch file. Get the correct patch file from the server.</li>
  <li class="li3">The message <span class="s9">installed version of CNSsolve has the wrong patch level for this patch file</span> is given and the patching process stops. You have the correct CNSsolve version but it is at the wrong patch level for this patch file. Get the correct patch file from the server.</li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Installing the CNSsolve HTML interface locally</b></h2>
<p class="p2">In order to provide users with efficient access to the CNSsolve HTML interface it is possible to install a local version on a WWW server. This requires:</p>
<ul class="ul1">
  <li class="li3">experience in WWW server administration</li>
  <li class="li3">access to a local WWW server</li>
  <li class="li3">the CNSsolve installation directory must be visible on the WWW server</li>
  <li class="li3">appropriate privilege to make directories, and add links on the WWW server (asking a system administrator may be required)</li>
  <li class="li3">PERL version 5 or higher must be installed on the WWW server</li>
</ul>
<p class="p2">Installation of the interface is performed in two stages. First, changes must be made to the CNSsolve installation to customize certain files for your local CNSsolve HTML interface setup. Second, changes must be made on the WWW server to integrate the CNSsolve HTML interface into the WWW server. Both of these tasks are performed by scripts supplied with CNSsolve.</p>
<p class="p2">CNSsolve stage of HTML installation:</p>
<ul class="ul1">
  <li class="li3">go to the CNSsolve installation directory</li>
  <li class="li6"><span class="s2">type </span>bin/www_cns_setup</li>
  <li class="li3">provide the information requested</li>
</ul>
<p class="p2">WWW server stage of HTML installation:</p>
<ul class="ul1">
  <li class="li3">log onto the WWW server</li>
  <li class="li6"><span class="s2">type </span>"CNSsolve-location"/bin/www_server_setup</li>
  <li class="li3">provide the information requested</li>
</ul>
<p class="p2">It is important that the correct information is given in both cases. Prior to installation please find out:</p>
<ul class="ul1">
  <li class="li3">the hostname of the WWW server</li>
  <li class="li3">the full path to the start of the WWW tree (i.e. the directory out of which documents are served by your WWW server)</li>
  <li class="li3">the location of the CGI directory on the server</li>
  <li class="li3">the full name of the PERL executable on the server (including the path)</li>
</ul>
<p class="p2">Once the CNSsolve HTML interface has been installed, users accessing the local CNSsolve documentation (e.g. via cns_web) will automatically be using the local HTML interface.</p>
<p class="p2">Each <i>version</i> of CNSsolve will install its HTML interface into unique space on the WWW server. It is possible therefore to have several versions of CNSsolve installed, all of which are fully functional. By accessing the appropriate CNSsolve documentation page the user will arrive at the CNSsolve HTML interface for that version.</p>
<p class="p2">The CNSsolve HTML installation stage will create some new versions of files in the doc/html directory which are customized to your local WWW setup (the information you determined above).</p>
<p class="p2">The WWW server installation stage will create some new directories on the server and add links from these directories to files in the CNSsolve installation. Links are used so that updating of the WWW server is generally not required if changes are made to the CNSsolve installation (e.g. after a patch). However, the CNSsolve PERL scripts are copied to the CGI directory on the local WWW server - this is because links are not usually permitted for executable scripts in a CGI directory. Therefore, if these scripts change significantly it may be necessary to rerun the WWW server installation.</p>
<p class="p2">After application of a CNSsolve patch the CNSsolve administrator may be required to rerun bin/www_cns_setup to update the customized CNSsolve files.</p>
<p class="p2">The CGI scripts used by the CNSsolve HTML interface require temporary space to write files. The scripts will automatically create directories in /usr/tmp on your WWW server. Each time the scripts are run they will remove any out-of-date files in the temporary space. If you wish to use a different location for these temporary files please contact the CNS developers at Yale.</p>
<p class="p2">The HTML interface for a particular version of CNSsolve can be removed by using the commands:</p>
<ul class="ul1">
  <li class="li4">$CNS_SOLVE/bin/www_server_remove (by the WWW server administrator)</li>
  <li class="li4">$CNS_SOLVE/bin/www_cns_remove (by the CNSsolve administrator)</li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Known Problems</b></h2>
<p class="p2">There is a bug in the NCSA HTTP daemon version 1.5.2a running under DEC Unix. This results in corruption of large (greater than 32 Kbytes) files returned by CGI scripts. There is a patch file available by ftp from CNS development (other-patches/ncsa_httpd_1.5.2a.patch). To apply this patch on your WWW server:</p>
<ul class="ul1">
  <li class="li8">cd ~httpd/src</li>
  <li class="li8">patch cgi.c &lt; ncsa_httpd_1.5.2a.patch</li>
</ul>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Running the distributed test files</b></h2>
<p class="p2">CNSsolve is distributed with a large suite of test files. To run all the test files:</p>
<ul class="ul1">
  <li class="li6">cd $CNS_INST</li>
  <li class="li3">check if a directory called "test" exists. If not, create one by "<span class="s4">mkdir test</span>"</li>
  <li class="li6">cd test</li>
  <li class="li6">run_tests -link</li>
  <li class="li6">run_tests *.inp</li>
  <li class="li6">run_diffs *.inp</li>
  <li class="li3">check the *.diff* files. The differences should be small and relatively minor</li>
  <li class="li3">examples of expected differences are:</li>
  <ul class="ul2">
    <li class="li4">&lt; Running on machine: atbmac3.local (Mac/Intel,64-bit)<br>
---<br>
&gt; Running on machine: atbmac2.Stanford.EDU (Mac/Intel,64-bit)</li>
    <li class="li4">&lt; Maximum dynamic memory allocation: 8112840 bytes<br>
&lt; Maximum dynamic memory overhead: 672 bytes<br>
---<br>
&gt; Maximum dynamic memory allocation: 4056420 bytes<br>
&gt; Maximum dynamic memory overhead: 504 bytes</li>
    <li class="li4">&lt; Corresp. rotation angle 0.6 about axis -0.31 0.33 0.89<br>
---<br>
&gt; Corresp. rotation angle 0.6 about axis -0.3 0.33 0.89</li>
    <li class="li4">&lt; | Etotal = 2.2e+04 grad(E)=6.7e+02 E(BOND)= 2.4e+03 E(ANGL)= 7.9e+03 |<br>
&lt; | E(IMPR)= 1.1e+04 E(VDW )=8.7e+02 E(CDIH)= 0.75 E(NOE )= 32 |<br>
---<br>
&gt; | Etotal = 1.7e+04 grad(E)= 94 E(BOND)= 2.4e+03 E(ANGL)= 7.9e+03 |<br>
&gt; | E(IMPR)= 6.3e+03 E(VDW )=8.7e+02 E(CDIH)= 0.75 E(NOE )= 32 |</li>
    <li class="li4">&lt; [H= 1 K= 1 L= 1] Amplitude= 0.61 Phase= 3.6e+02<br>
---<br>
&gt; [H= 1 K= 1 L= 1] Amplitude= 0.61 Phase= 0</li>
  </ul>
</ul>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Running the distributed task files</b></h2>
<p class="p2">CNSsolve is distributed with task files for many crystallographic and NMR procedures. In general these files will be accessed by local users - either through the CNSsolve HTML interface or a standard text editor. However, it is possible to run these task files in order to check the CNSsolve installation on a particular machine. Please note that this will take a long time, anything from several hours to a day depending on the hardware. To run all the task files:</p>
<ul class="ul1">
  <li class="li6">cd $CNS_SOLVE</li>
  <li class="li6">make run_inputs</li>
  <li class="li6">cd inputs</li>
  <li class="li3"><span class="s4">cd 'directory'</span> (e.g. xtal_refine)</li>
  <li class="li3"><span class="s4">cd run </span>(this is where the task files are run)</li>
  <li class="li3">check the .out files for errors or premature termination</li>
</ul>
<p class="p2">To run task files in a subdirectory:</p>
<ul class="ul1">
  <li class="li6">cd $CNS_SOLVE/inputs</li>
  <li class="li3"><span class="s4">cd 'directory'</span> (e.g. xtal_refine)</li>
  <li class="li3"><span class="s4">cd run</span> (this is where the task files are run)</li>
  <li class="li3"><span class="s4">make link</span> (adds links to task and data files)</li>
  <li class="li3"><span class="s4">make</span> (will run all task files in directory)</li>
  <li class="li6">make anneal model_map minimize<span class="s2"> (will run selected task files)</span></li>
  <li class="li3">check the .out files for errors or premature termination</li>
  <li class="li3"><span class="s4">make clean </span>will remove all links and output files in the run directory</li>
</ul>
<p class="p9"><br></p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Changing array dimensions</b></h2>
<p class="p2">The array dimensions for several arrays which may need to be changed (e.g. the maximum number of atoms) are defined at compile time in the include file $CNS_SOLVE/source/cns.inc. Modify this file then recompile CNSsolve using make cns_solve.</p>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times; min-height: 23.0px"><b></b><br></h2>
<h2 style="margin: 0.0px 0.0px 14.0px 0.0px; font: 18.0px Times"><b>Debugging source code</b></h2>
<p class="p2">If changes to the code are made, a debugger may be used to track possible possible programming errors. In order to recompile a specific source file for debugging use the following:</p>
<ul class="ul1">
  <li class="li6">touch 'source-file'.f</li>
  <li class="li6">make update debug='-g' ! note: for the ifort compiler you must use debug='-g -save-temps'</li>
  <li class="li6">&lt;debug_command&gt; $CNS_INST/bin/cns_solve</li>
</ul>
<p class="p2">The &lt;debug_command&gt; depends on the compiler that is used. For the Intel ifort compiler it is "idb". For the Portland group pgf95 compiler it is "pgdbg". The touch is only required if the program has been recompiled since the source file was last modified. The debug flag(s) will be passed on to the compiler.</p>
<p class="p2">Once debugging is completed the code should be recompiled without any debugging flags after touching the appropriate source files (make cns_solve). For advanced debugging with the ifort compiler (MAC OS X or Linux) use the following command:</p>
<ul class="ul1">
  <li class="li6">make install compiler=ifort debug='-g -mp -traceback -debug extended -debug inline_debug_info'</li>
</ul>
<p class="p2">It sometimes helps to include "<span class="s4">-check uninit</span>" which emits a run-time error if memory is accessed that is not initialized. On linux systems, you can also try the Electric Fence (<span class="s4">-lefence</span>) option.</p>
<p class="p2"><i>OpenMP profiler (64bit Linux version only)</i></p>
<p class="p2">Install CNS using "<span class="s4">make install</span> <span class="s4">compiler=ifort_openmp_profiler"</span>. The program execution will produce a file guide.gvs file with profiling information. To test if it's worth parallelizing a particular loop insert the following statement before the loop:</p>
<p class="p5">!$omp parallel do num_threads(1) ! no private and shared clauses needed</p>
<p class="p2"><i>OpenMP threading check (64bit Linux version only)</i></p>
<p class="p2">The tcheck threading analysis tool needs to be installed. Then install CNS using "<span class="s4">make install</span> <span class="s4">compiler=ifort_openmp_tcheck</span>". Make sure the tcheck system variables are defined by executing the tcheckvars.csh shell file. To execute the program after compiling with the tcheck option enabled:</p>
<ul class="ul1">
  <li class="li6">tcheck_cl &lt;cns binary location&gt; &lt; input_file &gt; output_file</li>
</ul>
<p class="p2">The resulting threading info will be written to the end of the output file. If everything is OK the following summary will appear:</p>
<p class="p2">Intel(R) Thread Checker 3.1 command line instrumentation driver (26185)<span class="s5"><br>
</span>Copyright (c) 2007 Intel Corporation. All rights reserved.</p>
<table cellspacing="0" cellpadding="0" class="t1">
  <tbody>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3">ID</p>
      </td>
      <td valign="middle" class="td3">
        <p class="p3">Short Desc</p>
      </td>
      <td valign="middle" class="td4">
        <p class="p3">Severit</p>
      </td>
      <td valign="middle" class="td5">
        <p class="p3">Cou</p>
      </td>
      <td valign="middle" class="td6">
        <p class="p3">Context[</p>
      </td>
      <td valign="middle" class="td7">
        <p class="p3">Description</p>
      </td>
      <td valign="middle" class="td8">
        <p class="p3">1st Acc</p>
      </td>
      <td valign="middle" class="td9">
        <p class="p3">2nd Acc</p>
      </td>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
      <td valign="middle" class="td2">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td3">
        <p class="p3">ription</p>
      </td>
      <td valign="middle" class="td4">
        <p class="p3">y Name</p>
      </td>
      <td valign="middle" class="td5">
        <p class="p3">nt</p>
      </td>
      <td valign="middle" class="td6">
        <p class="p3">Best]</p>
      </td>
      <td valign="middle" class="td7">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td8">
        <p class="p3">ess[Bes</p>
      </td>
      <td valign="middle" class="td9">
        <p class="p3">ess[Bes</p>
      </td>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
      <td valign="middle" class="td2">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td3">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td5">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td7">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td8">
        <p class="p3">t]</p>
      </td>
      <td valign="middle" class="td9">
        <p class="p3">t]</p>
      </td>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
      <td valign="middle" class="td2">
        <p class="p3">1</p>
      </td>
      <td valign="middle" class="td3">
        <p class="p3">Thread ter</p>
      </td>
      <td valign="middle" class="td4">
        <p class="p3">Informa</p>
      </td>
      <td valign="middle" class="td5">
        <p class="p3">1</p>
      </td>
      <td valign="middle" class="td6">
        <p class="p3">Whole</p>
      </td>
      <td valign="middle" class="td7">
        <p class="p3">Thread termination at</p>
      </td>
      <td valign="middle" class="td8">
        <p class="p3">cns.f</p>
      </td>
      <td valign="middle" class="td9">
        <p class="p3">cns.f</p>
      </td>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
      <td valign="middle" class="td2">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td3">
        <p class="p3">mination</p>
      </td>
      <td valign="middle" class="td4">
        <p class="p3">tion</p>
      </td>
      <td valign="middle" class="td5">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p3">Program1</p>
      </td>
      <td valign="middle" class="td7">
        <p class="p3">cns.f:1 - includes stack</p>
      </td>
      <td valign="middle" class="td8">
        <p class="p3">:1</p>
      </td>
      <td valign="middle" class="td9">
        <p class="p3">:1</p>
      </td>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
      <td valign="middle" class="td2">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td3">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td5">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td7">
        <p class="p3">allocation of 2.462 GB and</p>
      </td>
      <td valign="middle" class="td8">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td9">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
    </tr>
    <tr>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
      <td valign="middle" class="td2">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td3">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td4">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td5">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td6">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td7">
        <p class="p3">use of 116.859 KB</p>
      </td>
      <td valign="middle" class="td8">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td9">
        <p class="p11"><br></p>
      </td>
      <td valign="middle" class="td1">
        <p class="p3"> </p>
      </td>
    </tr>
  </tbody>
</table>
<p class="p7"> </p>
<p class="p12"><br></p>
<p class="p13"><br></p>
<p class="p14"><br></p>
</body>
</html>
